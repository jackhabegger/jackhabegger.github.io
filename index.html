<!DOCTYPE html>
<html>
<style>
	.mainTitle {
		color:  #13294B;
		font-family: Arial;
		font-size:  20px;
		font-weight: normal;
		text-align: center;
		text-shadow: 0 2.5px 2.5px rgb(160, 146, 146);
	}

	.subheading {
		color: #13294B;
		font-family: Arial;
		font-weight: bold;
		text-align: center;
		font-size: 16;
	}

	.charttitles {
		color: #13294B;
		font-family: Arial;
		font-weight: normal;
		text-align: center;
		font-size: 10;
	}

	.about {
		color: #13294B;
		font-family: Arial;
		font-weight: normal;
		text-align: center;
		font-size: 12;
		margin-left: 17.5%;
		margin-right: 17.5%;
	}

	.links { 
		text-align: center;   
	}
    
    .button { 
        display: inline-block;
        text-align: justify;
		font-size: 15px;
    }

	.container {
		display: flex;
		justify-content: center;
	}

	#map {
        transform: scale(1,-1);
        display: flex;
    }

    div.tooltip {
        position: absolute;
        text-align: center;			
        width: 60px;					
        height: 27px;					
        padding: 2px;				
        font: 10px sans-serif;		
        background: #7BAFD4;	
        border: 0px;		
        border-radius: 8px;			
        pointer-events: none;
    }
</style>

<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<title>H517 Project 1 - Jack Habegger</title>
</head>

<body>
	<main>
	<div class="mainTitle">
		<h1>H517 Project 1 - London's 1854 Cholera Epidemic</h1>
	</div>
	<br>
	<div class="links">
		<div class="button">
			<form>
				<button type="submit" formaction="https://en.wikipedia.org/wiki/John_Snow#/media/File:Snow-cholera-map-1.jpg">
				John Snow's Original Map</button>
			</form>
		</div>
		<div class="button">
			<form>
				<button type="submit" formaction="documentation.html">Documentation Page</button>
			</form>
		</div>
	</div>
	<div>
		<h2 class = "subheading">About</h2>
		<p class = "about">
			In 1854, Dr. John Snow leveraged the power of data visualization
			to explore and ulitmately identify the source of the cholera
			outbreak in London. Below is a modernized representation of
			Snow's street map along with a collection of additional visualizations
			aimed to provide further insight into the totality of death
			caused by the outbreak.
		</p>
	</div>
	<br>
	<div>
		<h2 class="subheading">Cholera Map</h2>
		<p class="about">Click and drag to move the map. Move the cursor over the map and scroll to zoom in and out. Move the cursor
						 over a red dot to show the age and gender of the victim.
		</p>
	</div>
	<div class="container" id=map></div>
	<br>
	<div>
		<h2 class="subheading">Additional Visualizations</h2>
		<p class="about"> Timeline of Deaths (left); Total Deaths by Gender (middle); Total Deaths by Age Range (right) </p>
	</div>
	<div class="container">
	<div id="charts"></div>
	</div>
	<script>
		// LINE CHART
		var margin1 = {top:10, right:10, bottom:60, left:60};
			width1 = 600 - margin1.left - margin1.right,
			height1 = 400 - margin1.top - margin1.bottom;

		var svg1 = d3.select("#charts")
		.append("svg")
			.attr("width", width1 + margin1.left + margin1.right)
			.attr("height", height1 + margin1.top + margin1.bottom)
		.append("g")
			.attr("transform",
					"translate(" + margin1.left + "," + margin1.top + ")");

		var formatTime = d3.timeFormat("%b %e");

		var div = d3.select("body").append("div")	
    		.attr("class", "tooltip")				
   			.style("opacity", 0);

		// read the data
		d3.csv("deathdays.csv", function(d){
			return {date: d3.timeParse("%e-%b")(d.date), deaths: d.deaths}
		},

		function(data) {

			// X axis
			var x = d3.scaleTime()
				.domain(d3.extent(data, function(d) {return d.date}))
				.range([0, width1]);
			svg1.append("g")
				.attr("transform", "translate(0," + height1 + ")")
				.call(d3.axisBottom(x));

			// Y axis
			var y = d3.scaleLinear()
				.domain([0, d3.max(data, function(d) {return +d.deaths;})])
				.range([height1, 0]);
			svg1.append("g")
				.call(d3.axisLeft(y));

			// line
			svg1.append("path")
				.datum(data)
				.attr("fill", "none")
				.attr("stroke", "#7BAFD4")
				.attr("stroke-width", 2.5)
				.attr("d", d3.line()
					.x(function(d) {return x(d.date)})
					.y(function(d) {return y(d.deaths)}));

			// data labels + tooltip
			svg1.selectAll("dot")
				.data(data)
			.enter().append("circle")
				.attr("r", 3)
				.attr("cx", function(d) {return x(d.date)})
				.attr("cy", function(d) {return y(d.deaths)})
				.style("fill", "#13294B")
				.on("mouseover", function(d) {		
            		div.transition()		
                		.duration(200)		
                		.style("opacity", .9);		
            		div.html("Deaths: " + d.deaths + "<br/>" + "Date: " + formatTime(d.date))	
                		.style("left", (d3.event.pageX) + "px")		
                		.style("top", (d3.event.pageY - 28) + "px");	
            		})					
        		.on("mouseout", function(d) {		
            		div.transition()		
                		.duration(500)		
                		.style("opacity", 0);
                });
				
			// x-axis label
			svg1.append("text")
				.attr("x", "252.5")
				.attr("y", "375")
				.style("fill", "black")
				.style("font-family", "Arial")
				.style("font-size", "15px")
				.text("Date")

			// y-axis label
			svg1.append("text")
				.attr("x", "-200")
				.attr("y", "-35")
				.attr("transform", "rotate(270)")
				.style("font-family", "Arial")
				.style("fill", "black")
				.style("font-size", "15px")
				.text("Deaths")
		});

	// BAR GRAPH - By Gender
	var margin2 = {top: 20, right: 20, bottom: 60, left: 40},
    width2 = 400 - margin2.left - margin2.right,
    height2 = 400 - margin2.top - margin2.bottom;

	var x = d3.scaleBand()
          .range([0, width2])
          .padding(0.1);
	var y = d3.scaleLinear()
          .range([height2, 0]);

	var svg2 = d3.select("#charts")
			.append("svg")
    			.attr("width", width2 + margin2.left + margin2.right)
    			.attr("height", height2 + margin2.top + margin2.bottom)
  				.append("g")
    			.attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");

	// read the data
	d3.csv("male_female_deaths.csv", function(error, data) {
 				if (error) throw error;

  	data.forEach(function(d) {
    	d.deaths = +d.deaths;
  	});

  	// Scale the range of the data in the domains
  	x.domain(data.map(function(d) { return d.gender; }));
  	y.domain([0, d3.max(data, function(d) { return d.deaths; })]);

  	svg2.selectAll("bar")
       	.data(data)
       	.enter().append("rect")
       	.attr("class", "bar")
       	.attr("x", function(d) { return x(d.gender); })
       	.attr("width", x.bandwidth())
       	.attr("y", function(d) { return y(d.deaths); })
       	.attr("height", function(d) { return height2 - y(d.deaths); })
       	.attr("fill", "#13294B");

  	svg2.append("g")
      	.attr("transform", "translate(0," + height2 + ")")
      	.call(d3.axisBottom(x));

  	svg2.append("g")
      	.call(d3.axisLeft(y));

	svg2.append("text")
		.attr("x", "145")
		.attr("y", "360")
		.style("fill", "black")
		.style("font-family", "Arial")
		.style("font-size", "15px")
		.text("Gender")

	svg2.append("text")
		.attr("x", "67.5")
		.attr("y", "35")
		.style("fill", "#7BAFD4")
		.style("font-family", "Arial")
		.style("font-size", "25px")
		.style("font-weight", "bold")
		.text("284")

	svg2.append("text")
		.attr("x", "230")
		.attr("y", "30")
		.style("fill", "#7BAFD4")
		.style("font-family", "Arial")
		.style("font-size", "25px")
		.style("font-weight", "bold")
		.text("287")
});

// BAR GRAPH - Age Ranges
	var margin3 = {top: 20, right: 20, bottom: 60, left: 40},
    width3 = 400 - margin3.left - margin3.right,
    height3 = 400 - margin3.top - margin3.bottom;

	var x = d3.scaleBand()
          .range([0, width3])
          .padding(0.1);
	var y = d3.scaleLinear()
          .range([height3, 0]);
          
	var svg3 = d3.select("#charts")
			.append("svg")
    			.attr("width", width3 + margin3.left + margin3.right)
    			.attr("height", height3 + margin3.top + margin3.bottom)
  				.append("g")
    			.attr("transform", "translate(" + margin3.left + "," + margin3.top + ")");

	// read the data
	d3.csv("age_range_deaths.csv", function(error, data) {
 				if (error) throw error;

  	data.forEach(function(d) {
    	d.deaths = +d.deaths;
  	});

  	x.domain(data.map(function(d) { return d.age; }));
  	y.domain([0, d3.max(data, function(d) { return d.deaths; })]);

  	svg3.selectAll(".bar")
       .data(data)
       .enter().append("rect")
       .attr("class", "bar")
       .attr("x", function(d) { return x(d.age); })
       .attr("width", x.bandwidth())
       .attr("y", function(d) { return y(d.deaths); })
       .attr("height", function(d) { return height3 - y(d.deaths); })
       .attr("fill", "#13294B");

  	svg3.append("g")
      	.attr("transform", "translate(0," + height3 + ")")
      	.call(d3.axisBottom(x));

  	svg3.append("g")
      	.call(d3.axisLeft(y));

	svg3.append("text")
		.attr("x", "135")
		.attr("y", "360")
		.style("fill", "black")
		.style("font-family", "Arial")
		.style("font-size", "15px")
		.text("Age Range")

	svg3.append("text")
		.attr("x", "14")
		.attr("y", "80")
		.style("fill", "#7BAFD4")
		.style("font-family", "Arial")
		.style("font-size", "20px")
		.style("font-weight", "bold")
		.text("143")

	svg3.append("text")
		.attr("x", "75")
		.attr("y", "255")
		.style("fill", "#7BAFD4")
		.style("font-family", "Arial")
		.style("font-size", "20px")
		.style("font-weight", "bold")
		.text("48")

	svg3.append("text")
		.attr("x", "130")
		.attr("y", "235")
		.style("fill", "#7BAFD4")
		.style("font-family", "Arial")
		.style("font-size", "20px")
		.style("font-weight", "bold")
		.text("58")

	svg3.append("text")
		.attr("x", "185")
		.attr("y", "237.5")
		.style("fill", "#7BAFD4")
		.style("font-family", "Arial")
		.style("font-size", "20px")
		.style("font-weight", "bold")
		.text("57")

	svg3.append("text")
		.attr("x", "241")
		.attr("y", "177.5")
		.style("fill", "#7BAFD4")
		.style("font-family", "Arial")
		.style("font-size", "20px")
		.style("font-weight", "bold")
		.text("91")

	svg3.append("text")
		.attr("x", "291.5")
		.attr("y", "22.5")
		.style("fill", "#7BAFD4")
		.style("font-family", "Arial")
		.style("font-size", "20px")
		.style("font-weight", "bold")
		.text("174")

});

	// create map
    var margin4 = {top4: 5, right4: 30, bottom4: 40, left4: 10},
	width4 = 550 - margin4.left4 - margin4.right4,
	height4 = 450 - margin4.top4 - margin4.bottom4;

    var svg = d3.select("#map")
    	.append("svg")
        	.attr("width", width4)
        	.attr("height", height4)
        	.call(d3.zoom().on("zoom", function () {
        		svg.attr("transform", d3.event.transform)
        	}))
        .append("g");

    var div = d3.select("main")
        .append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

 	d3.json("streets.json", function(error, data) {
        streets = data;
        console.log(data)

        var g = svg.selectAll("g")
                   	.data(data)
                    .enter().append("line")
                    .attr("class", "link")
                    .style('stroke','darkgrey')
                    .style("stroke-width", 1.5)
                    .attr("x1", function(d) { return d[0].x*20;})
                    .attr("y1", function(d) { return d[0].y*20;})
                    .attr("x2", function(d) { return d[1].x*20;})
                    .attr("y2", function(d) { return d[1].y*20;});

    d3.csv("pumps.csv", function(error, data) {
        pumps = data;
        console.log(data)

                var g = svg.selectAll("circle")
                    .data(data)
                    .enter().append("circle")
                    .attr("cx", function(d) { return d.x*20;})
                    .attr("cy", function(d) { return d.y*20;})
                    .attr("r", 4)
                    .style("fill", "blue")
                });

    d3.csv("deaths_age_sex.csv", function(error, data) {
    	var g = svg.selectAll("circle")
                    .data(data)
                    .enter().append("circle")
                    .attr("cx", function(d) { return d.x*20;})
                    .attr("cy", function(d) { return d.y*20;})
                    .attr("r", 1)
                    .style("fill", 'red')
                    .on("mouseover", function(d) {
                    	div.transition()		
                            .duration(200)		
                            .style("opacity", .9);		
                        div.html("Age: " + d.age + "<br/>"  + "Gender: "+ d.gender)	
                            .style("left", (d3.event.pageX) + "px")		
                            .style("top", (d3.event.pageY - 28) + "px");	
                        })
                    .on("mouseout", function(d) {
                    	div.transition()
                            .duration(500)
                            .style("opacity", 0);
                    });
                })

    	// Add missing lines to complete the map border
    	svgLine = svg.append("line")
    		.attr("x1", 379)
            .attr("y1", -142)
            .attr("x2", 245)
            .attr("y2", -114)
            .attr("transform", "scale(1, -1) rotate(10)")
           	.style('stroke','darkgrey')
            .style("stroke-width", 1.5);

        svgLine = svg.append("line")
            .attr("x1", 378)
            .attr("y1", -145)
            .attr("x2", 315)
            .attr("y2", -439)
            .attr("transform", "scale(1, -1) rotate(10.5)")
            .style('stroke','darkgrey')
            .style("stroke-width", 1.5);

        svgLine = svg.append("line")
        	.attr("x1", 76)
            .attr("y1", -62)
            .attr("x2", 101)
            .attr("y2", -56)
            .attr("transform", "rotate(80)")
            .style('stroke','darkgrey')
           	.style("stroke-width", 1.5);

        svgRect = svg.append("rect")
            .attr("x", 279.15)
            .attr("y", -4.5)
            .attr("width", 21)
            .attr("height", 22)
            .style("fill", "Black")
            .attr("transform", "scale(1, -1) rotate(-36)");

        svgText = svg.append("text")
            .attr("x", 288)
            .attr("y", 27)
            .style("fill", "gold")
            .style("font-weight", "bold")
            .style("font-size", "5px")
            .style("font-family", "Arial")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1) rotate(-41)")
            .text("Golden"); 

        svgText = svg.append("text")
            .attr("x", 287)
            .attr("y", 35)
            .style("fill", "gold")
            .style("font-weight", "bold")
            .style("font-size", "5px")
            .style("font-family", "Arial")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1) rotate(-41)")
            .text("Square");

        svgText = svg.append("text")
            .attr("x", 274)
            .attr("y", 59)
            .style("fill", "black")
            .style("font-weight", "bold")
            .style("font-size", "7.5px")
            .style("font-family", "Arial")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1) rotate(-41)")
            .text("Brewer St.");  
                    
        svgText = svg.append("text")
            .attr("x", -93)
            .attr("y", -246)
            .style("fill", "black")
            .style("font-weight", "bold")
            .style("font-size", "7.5px")
            .style("font-family", "Arial")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1) rotate(60)")
            .text("Regent St.");

        svgText = svg.append("text")
            .attr("x", 268)
            .attr("y", -185)
            .style("fill", "black")
            .style("font-weight", "bold")
            .style("font-family", "Arial")
            .style("font-size", "7.5px")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1) rotate(-23)")
            .text("Great Marlborough St.");
                
        svgText = svg.append("text")
            .attr("x", 323)
            .attr("y", -95)
            .style("fill", "black")
            .style("font-weight", "bold")
            .style("font-family", "Arial")
            .style("font-size", "7.5px")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1) rotate(-28)")
            .text("Broad St.");

        svgRect = svg.append("rect")
            .attr("x", 305)
            .attr("y", -145)
            .attr("width", 30)
            .attr("height", 18)
            .style("fill", "black")
            .attr("transform", "scale(1, -1) rotate(-28)");

        svgText = svg.append("text")
            .attr("x", 320)
            .attr("y", -140)
            .style("fill", "white")
            .style("font-family", "Arial")
            .style("font-size", "5px")
            .style("font-weight", "bold")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1) rotate(-28)")
            .text("Work");

        svgText = svg.append("text")
            .attr("x", 320)
            .attr("y", -133)
            .style("fill", "white")
            .style("font-family", "Arial")
            .style("font-size", "5px")
            .style("font-weight", "bold")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1) rotate(-28)")
            .text("House");

        svgRect = svg.append("rect")
            .attr("x", -77)
            .attr("y", -365)
            .attr("width", 21)
            .attr("height", 11.15)
            .style("fill", "black")
            .attr("transform", "scale(1, -1) rotate(60)");

        svgText = svg.append("text")
            .attr("x", -66.5)
            .attr("y", -360)
            .style("fill", "white")
            .style("font-family", "Arial")
            .style("font-weight", "bold")
            .style("font-size", "4.5px")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1) rotate(60)")
            .text("Brewery");

    	svgCircle = svg.append("circle")
            .attr("cx", 395)
            .attr("cy", -359)
            .attr("r", 3)
            .attr("transform", "rotate(80)")
            .style("fill", "red");

        svgText = svg.append("text")
            .attr("x", 457)
            .attr("y", -312)
            .style("fill", "black")
            .style("font-family", "Arial")
            .style("font-weight", "bold")
            .style("font-size", "10px")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1) rotate(-2)")
            .text("Deaths");

        svgCircle = svg.append("circle")
            .attr("cx", 378)
            .attr("cy", -362)
            .attr("r", 5)
            .attr("transform", "rotate(80)")
            .style("fill", "blue");

        svgText = svg.append("text")
            .attr("x", 457)
            .attr("y", -295)
            .style("fill", "black")
            .style("font-family", "Arial")
            .style("font-weight", "bold")
            .style("font-size", "10px")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1) rotate(-2)")
            .text("Pumps");

        svgText = svg.append("text")
            .attr("x", 11)
            .attr("y", -330)
            .style("fill", "black")
            .style("font-weight", "bold")
            .style("font-family", "Arial")
            .style("font-size", "10px")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1)")
            .text("Key:");

        svgText = svg.append("text")
            .attr("x", 29)
            .attr("y", -318)
            .style("fill", "black")
            .style("font-family", "Arial")
            .style("font-size", "10px")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1)")
            .text("Age 0 =  0-10");

        svgText = svg.append("text")
            .attr("x", 41)
            .attr("y", -307)
            .style("fill", "black")
            .style("font-family", "Arial")
            .style("font-size", "10px")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1)")
            .text("1 =  11-20");
                
        svgText = svg.append("text")
            .attr("x", 41)
            .attr("y", -294)
            .style("fill", "black")
            .style("font-family", "Arial")
            .style("font-size", "10px")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1)")
            .text("2 =  21-40");

        svgText = svg.append("text")
            .attr("x", 41)
            .attr("y", -282)
            .style("fill", "black")
            .style("font-family", "Arial")
            .style("font-size", "10px")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1)")
            .text("3 =  41-60");

        svgText = svg.append("text")
            .attr("x", 41)
            .attr("y", -270)
            .style("fill", "black")
            .style("font-family", "Arial")
            .style("font-size", "10px")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1)")
            .text("4 =  61-80");

        svgText = svg.append("text")
            .attr("x", 37)
            .attr("y", -258)
            .style("fill", "black")
            .style("font-family", "Arial")
            .style("font-size", "10px")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1)")
            .text("5 = 80+");

        svgText = svg.append("text")
            .attr("x", 21)
            .attr("y", -240)
            .style("fill", "black")
            .style("font-family", "Arial")
            .style("font-size", "10px")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1)")
            .text("Male - 0;");

        svgText = svg.append("text")
            .attr("x", 26)
            .attr("y", -228)
            .style("fill", "black")
            .style("font-family", "Arial")
            .style("font-size", "10px")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .attr("transform", "scale(1, -1)")
            .text("Female - 1;");

        
});
	</script>
	</main>
</body>
</html>